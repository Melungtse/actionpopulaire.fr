<div><textarea name="{{ widget.name }}"{% include "django/forms/widgets/attrs.html" %}>{% if widget.value %}{{ widget.value }}{% endif %}</textarea></div>
<script>
    var textarea = document.querySelector('#{{ widget.attrs.id }}');
    var editor = window.markdownEditor(textarea);

    var form = textarea.parentNode;
    while(form && form.tagName !== "FORM") {
        form = form.parentNode;
    }

    if(form) {
        form.addEventListener('submit', function(e) {
            if (editor.mode !== 'markdown') {
                textarea.value = editor.value();
            }

            return true;
        });
    }
</script>
