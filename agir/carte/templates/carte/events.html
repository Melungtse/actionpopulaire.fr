{% extends "carte/layout.html" %}

{% block title %}
    Carte des événements
{% endblock %}

{% block map_script %}
    <script>
      var types = {{ type_config }};
      var subtypes = {{ subtype_config }};
      var bounds = {{ bounds }};

      function formatEvent(event) {
        var subtype = subtypes.find(function (type) {
          return type.id === event.subtype
        });
        var type = types.find(function(type) {
          return type.id === subtype.type;
        });
        return (
          '<a href="{{ FRONT_DOMAIN }}/evenements/' + event.id + '/" style="color:' +
          (subtype.color ? subtype.color : type.color) +
          ';" target="_blank">' +
          event.name +
          '</a><br /><strong>' +
          (subtype.hideLabel ? type.label : subtype.description) +
          '</strong><br />le ' +
          new Date(event.start_time).toLocaleString()
        );
      }

      window['carte/map'].listMap('map', {
        endpoint: '{% url "carte:event_list" %}{{ querystring }}',
        type: 'events',
        types,
        subtypes,
        formatPopup: formatEvent,
        bounds
      });
    </script>
{% endblock %}
